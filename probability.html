<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="概率论基础 - 掌握概率分布、贝叶斯定理、条件概率等重要理论">
  <title>概率论基础 - 统计学学习平台</title>
  <link rel="stylesheet" href="assets/bootstrap-custom.css">
  <link rel="stylesheet" href="assets/katex-custom.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="main-content">
    <div class="probability-page">
      <h1 class="page-title">概率论基础</h1>

      <div class="content-card">
        <h2 class="card-title">🎲 什么是概率？</h2>
        <p>
          概率是衡量事件发生可能性的数值，取值范围在 0 到 1 之间。
          0 表示不可能发生，1 表示必然发生。概率论是研究随机现象的数学理论。
        </p>
        <div class="formula-box">
          $$P(A) = \frac{\text{事件A发生的有利结果数}}{\text{所有可能结果的总数}}$$
        </div>
      </div>

      <div class="content-card">
        <h2 class="card-title">📊 基本概念</h2>

        <h3 class="mt-4 mb-3">1. 条件概率</h3>
        <p>
          条件概率是在已知事件 B 发生的条件下，事件 A 发生的概率。
        </p>
        <div class="formula-box">
          $$P(A|B) = \frac{P(A \cap B)}{P(B)}$$
        </div>
        <p class="text-muted">其中 $P(A|B)$ 表示在 B 发生的条件下 A 发生的概率。</p>

        <h3 class="mt-4 mb-3">2. 乘法定理</h3>
        <p>
          两个事件同时发生的概率等于一个事件的概率乘以在该事件发生的条件下另一个事件的概率。
        </p>
        <div class="formula-box">
          $$P(A \cap B) = P(A) \times P(B|A) = P(B) \times P(A|B)$$
        </div>

        <h3 class="mt-4 mb-3">3. 贝叶斯定理</h3>
        <p>
          贝叶斯定理描述了条件概率之间的关系，是统计推断的重要工具。
        </p>
        <div class="formula-box">
          $$P(A|B) = \frac{P(B|A) \times P(A)}{P(B)}$$
        </div>
        <p class="text-muted">
          其中：
        </p>
        <ul>
          <li>$P(A)$ - 先验概率（在考虑 B 之前 A 的概率）</li>
          <li>$P(B|A)$ - 似然度（在 A 发生的条件下 B 发生的概率）</li>
          <li>$P(A|B)$ - 后验概率（在观察到 B 之后 A 的概率）</li>
        </ul>
      </div>

      <div class="content-card">
        <h2 class="card-title">📐 概率公理与基本性质</h2>

        <h3 class="mt-4 mb-3">1. 概率公理</h3>
        <p>柯尔莫哥洛夫概率公理是现代概率论的基石：</p>
        <ul>
          <li><strong>非负性：</strong>对任意事件 A，$P(A) \geq 0$</li>
          <li><strong>规范性：</strong>$P(\Omega) = 1$，其中 $\Omega$ 是样本空间</li>
          <li><strong>可列可加性：</strong>对于可数个互不相容的事件 $A_1, A_2, \ldots$，
          $$P(\bigcup_{i=1}^{\infty} A_i) = \sum_{i=1}^{\infty} P(A_i)$$
          </li>
        </ul>

        <h3 class="mt-4 mb-3">2. 基本概率公式</h3>

        <div class="mb-4">
          <h4>对立事件</h4>
          <p>事件 A 不发生的概率</p>
          <div class="formula-box">
            $$P(A^c) = 1 - P(A)$$
          </div>
          <p class="text-muted"><strong>应用：</strong>计算"至少一次"的概率、风险评估</p>
        </div>

        <div class="mb-4">
          <h4>加法公式</h4>
          <p>两个事件至少有一个发生的概率</p>
          <div class="formula-box">
            $$P(A \cup B) = P(A) + P(B) - P(A \cap B)$$
          </div>
          <p class="text-muted"><strong>应用：</strong>计算重叠事件的概率、市场渗透率分析</p>
        </div>

        <div class="mb-4">
          <h4>互斥事件（不相容事件）</h4>
          <p>两个事件不能同时发生，即 $A \cap B = \emptyset$</p>
          <div class="formula-box">
            $$P(A \cup B) = P(A) + P(B)$$
          </div>
          <p class="text-muted"><strong>应用：</strong>互斥投资组合、排他性选项分析</p>
        </div>

        <div class="mb-4">
          <h4>独立事件</h4>
          <p>一个事件的发生不影响另一个事件的概率</p>
          <div class="formula-box">
            $$P(A \cap B) = P(A) \times P(B)$$
            $$P(A|B) = P(A)$$
          </div>
          <p class="text-muted"><strong>应用：</strong>独立试验、系统可靠性分析、加密安全性</p>
        </div>
      </div>

      <div class="content-card">
        <h2 class="card-title">🔢 全概率公式与贝叶斯公式</h2>

        <h3 class="mt-4 mb-3">1. 全概率公式</h3>
        <p>如果事件 $B_1, B_2, \ldots, B_n$ 构成一个完备事件组（互斥且并集为样本空间），则：</p>
        <div class="formula-box">
          $$P(A) = \sum_{i=1}^{n} P(A|B_i) \times P(B_i)$$
        </div>
        <p class="text-muted"><strong>应用：</strong>分层抽样、多源风险评估、决策树分析</p>

        <h3 class="mt-4 mb-3">2. 贝叶斯定理的完整形式</h3>
        <p>利用全概率公式，贝叶斯定理可表示为：</p>
        <div class="formula-box">
          $$P(B_i|A) = \frac{P(A|B_i) \times P(B_i)}{\sum_{j=1}^{n} P(A|B_j) \times P(B_j)}$$
        </div>
        <p class="text-muted"><strong>应用：</strong>垃圾邮件过滤、医疗诊断、模式识别、机器学习分类算法</p>
      </div>

      <div class="content-card">
        <h2 class="card-title">📊 随机变量与数字特征</h2>

        <h3 class="mt-4 mb-3">1. 随机变量</h3>
        <p>将随机试验的结果映射到数值的函数。</p>
        <ul>
          <li><strong>离散型随机变量：</strong>取值为可数的（如抛硬币次数、掷骰子点数）</li>
          <li><strong>连续型随机变量：</strong>取值在某个区间内（如身高、温度、时间）</li>
        </ul>

        <h3 class="mt-4 mb-3">2. 概率质量函数 (PMF)</h3>
        <p>离散型随机变量取各值的概率：</p>
        <div class="formula-box">
          $$p_X(x) = P(X = x)$$
        </div>
        <p class="text-muted"><strong>性质：</strong>$\sum_x p_X(x) = 1$</p>

        <h3 class="mt-4 mb-3">3. 概率密度函数 (PDF)</h3>
        <p>连续型随机变量的密度函数：</p>
        <div class="formula-box">
          $$P(a \leq X \leq b) = \int_a^b f_X(x) dx$$
          $$\int_{-\infty}^{\infty} f_X(x) dx = 1$$
        </div>

        <h3 class="mt-4 mb-3">4. 累积分布函数 (CDF)</h3>
        <p>随机变量小于或等于某个值的概率：</p>
        <div class="formula-box">
          $$F_X(x) = P(X \leq x) = \begin{cases}
          \sum_{t \leq x} p_X(t) & \text{离散型} \\
          \int_{-\infty}^{x} f_X(t) dt & \text{连续型}
          \end{cases}$$
        </div>
        <p class="text-muted"><strong>应用：</strong>百分位数计算、风险概率评估、质量控制</p>

        <h3 class="mt-4 mb-3">5. 期望值（数学期望）</h3>
        <p>随机变量的"平均值"或"长期均值"：</p>
        <div class="formula-box">
          $$E[X] = \begin{cases}
          \sum_x x \cdot p_X(x) & \text{离散型} \\
          \int_{-\infty}^{\infty} x \cdot f_X(x) dx & \text{连续型}
          \end{cases}$$
        </div>
        <p class="text-muted"><strong>性质：</strong></p>
        <ul>
          <li>$E[aX + b] = aE[X] + b$</li>
          <li>$E[X + Y] = E[X] + E[Y]$</li>
          <li>$E[XY] = E[X]E[Y]$ （当 X, Y 独立时）</li>
        </ul>
        <p class="text-muted"><strong>应用：</strong>保险定价、投资回报评估、游戏设计、赌场优势计算</p>

        <h3 class="mt-4 mb-3">6. 方差</h3>
        <p>衡量随机变量围绕期望值的离散程度：</p>
        <div class="formula-box">
          $$Var(X) = E[(X - E[X])^2] = E[X^2] - (E[X])^2$$
        </div>
        <p class="text-muted"><strong>性质：</strong></p>
        <ul>
          <li>$Var(aX + b) = a^2 Var(X)$</li>
          <li>$Var(X + Y) = Var(X) + Var(Y)$ （当 X, Y 独立时）</li>
        </ul>
        <p class="text-muted"><strong>应用：</strong>风险管理、投资组合优化、质量控制</p>

        <h3 class="mt-4 mb-3">7. 标准差</h3>
        <p>方差的平方根，与随机变量具有相同的单位：</p>
        <div class="formula-box">
          $$\sigma_X = \sqrt{Var(X)}$$
        </div>

        <h3 class="mt-4 mb-3">8. 协方差</h3>
        <p>衡量两个随机变量的线性关系：</p>
        <div class="formula-box">
          $$Cov(X, Y) = E[(X - E[X])(Y - E[Y])] = E[XY] - E[X]E[Y]$$
        </div>
        <p class="text-muted"><strong>应用：</strong>投资组合风险分析、多元统计分析</p>

        <h3 class="mt-4 mb-3">9. 相关系数</h3>
        <p>标准化后的协方差，取值范围 [-1, 1]：</p>
        <div class="formula-box">
          $$\rho_{X,Y} = \frac{Cov(X, Y)}{\sqrt{Var(X)Var(Y)}}$$
        </div>
        <p class="text-muted"><strong>应用：</strong>相关性分析、特征选择、数据预处理</p>
      </div>

      <div class="content-card">
        <h2 class="card-title">📈 离散型概率分布</h2>

        <h3 class="mt-4 mb-3">1. 伯努利分布</h3>
        <p>描述单次二元试验（成功/失败）：</p>
        <div class="formula-box">
          $$P(X = k) = p^k (1-p)^{1-k}, \quad k \in \{0, 1\}$$
        </div>
        <p class="text-muted"><strong>参数：</strong>成功概率 p</p>
        <p class="text-muted"><strong>期望：</strong>$E[X] = p$</p>
        <p class="text-muted"><strong>方差：</strong>$Var(X) = p(1-p)$</p>
        <p class="text-muted"><strong>应用：</strong>抛硬币、产品质检、二分类问题</p>

        <h3 class="mt-4 mb-3">2. 二项分布</h3>
        <p>n 次独立伯努利试验中成功的次数：</p>
        <div class="formula-box">
          $$P(X = k) = \binom{n}{k} p^k (1-p)^{n-k}, \quad k = 0, 1, \ldots, n$$
        </div>
        <p class="text-muted"><strong>参数：</strong>试验次数 n，成功概率 p</p>
        <p class="text-muted"><strong>期望：</strong>$E[X] = np$</p>
        <p class="text-muted"><strong>方差：</strong>$Var(X) = np(1-p)$</p>
        <p class="text-muted"><strong>应用：</strong>质量抽检、民意调查、体育比赛胜负预测</p>

        <h3 class="mt-4 mb-3">3. 泊松分布</h3>
        <p>描述固定时间或空间内事件发生的次数：</p>
        <div class="formula-box">
          $$P(X = k) = \frac{e^{-\lambda} \lambda^k}{k!}, \quad k = 0, 1, 2, \ldots$$
        </div>
        <p class="text-muted"><strong>参数：</strong>平均发生率 λ</p>
        <p class="text-muted"><strong>期望：</strong>$E[X] = \lambda$</p>
        <p class="text-muted"><strong>方差：</strong>$Var(X) = \lambda$</p>
        <p class="text-muted"><strong>应用：</strong>客服中心来电数、网站访问量、放射性衰变、交通事故统计</p>

        <h3 class="mt-4 mb-3">4. 几何分布</h3>
        <p>获得首次成功所需的试验次数：</p>
        <div class="formula-box">
          $$P(X = k) = (1-p)^{k-1} p, \quad k = 1, 2, 3, \ldots$$
        </div>
        <p class="text-muted"><strong>参数：</strong>成功概率 p</p>
        <p class="text-muted"><strong>期望：</strong>$E[X] = \frac{1}{p}$</p>
        <p class="text-muted"><strong>方差：</strong>$Var(X) = \frac{1-p}{p^2}$</p>
        <p class="text-muted"><strong>应用：</strong>电话呼叫次数、抽奖次数、缺陷产品检测</p>

        <h3 class="mt-4 mb-3">5. 超几何分布</h3>
        <p>从有限总体中不放回抽样，成功次数的分布：</p>
        <div class="formula-box">
          $$P(X = k) = \frac{\binom{K}{k}\binom{N-K}{n-k}}{\binom{N}{n}}$$
        </div>
        <p class="text-muted"><strong>参数：</strong>总体大小 N，总体中成功数 K，抽样数 n</p>
        <p class="text-muted"><strong>应用：</strong>质量控制（不放回抽样）、抽奖、牌类游戏</p>
      </div>

      <div class="content-card">
        <h2 class="card-title">📈 连续型概率分布</h2>

        <h3 class="mt-4 mb-3">1. 均匀分布</h3>
        <p>在区间 [a, b] 上每个值出现的概率相同：</p>
        <div class="formula-box">
          $$f(x) = \begin{cases}
          \frac{1}{b-a} & a \leq x \leq b \\
          0 & \text{其他}
          \end{cases}$$
        </div>
        <p class="text-muted"><strong>期望：</strong>$E[X] = \frac{a+b}{2}$</p>
        <p class="text-muted"><strong>方差：</strong>$Var(X) = \frac{(b-a)^2}{12}$</p>
        <p class="text-muted"><strong>应用：</strong>随机数生成、模拟建模、排队论</p>

        <h3 class="mt-4 mb-3">2. 正态分布（高斯分布）</h3>
        <p>最重要的连续分布，许多自然现象都近似服从正态分布：</p>
        <div class="formula-box">
          $$f(x) = \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$
        </div>
        <p class="text-muted"><strong>参数：</strong>均值 μ，标准差 σ</p>
        <p class="text-muted"><strong>期望：</strong>$E[X] = \mu$</p>
        <p class="text-muted"><strong>方差：</strong>$Var(X) = \sigma^2$</p>
        <p class="text-muted"><strong>重要性质：</strong></p>
        <ul>
          <li>68.27% 的数据在 [μ-σ, μ+σ] 范围内</li>
          <li>95.45% 的数据在 [μ-2σ, μ+2σ] 范围内</li>
          <li>99.73% 的数据在 [μ-3σ, μ+3σ] 范围内</li>
        </ul>
        <p class="text-muted"><strong>应用：</strong>身高体重、测量误差、金融收益、自然现象建模</p>

        <h3 class="mt-4 mb-3">3. 标准正态分布</h3>
        <p>μ = 0, σ = 1 的正态分布，记为 Z ~ N(0,1)：</p>
        <div class="formula-box">
          $$Z = \frac{X - \mu}{\sigma}$$
        </div>
        <p class="text-muted"><strong>应用：</strong>标准化、假设检验、概率计算查表</p>

        <h3 class="mt-4 mb-3">4. 指数分布</h3>
        <p>描述独立随机事件之间的等待时间：</p>
        <div class="formula-box">
          $$f(x) = \begin{cases}
          \lambda e^{-\lambda x} & x \geq 0 \\
          0 & x < 0
          \end{cases}$$
        </div>
        <p class="text-muted"><strong>参数：</strong>率参数 λ</p>
        <p class="text-muted"><strong>期望：</strong>$E[X] = \frac{1}{\lambda}$</p>
        <p class="text-muted"><strong>方差：</strong>$Var(X) = \frac{1}{\lambda^2}$</p>
        <p class="text-muted"><strong>无记忆性：</strong>$P(X > s+t | X > s) = P(X > t)$</p>
        <p class="text-muted"><strong>应用：</strong>等待时间分析、寿命预测、排队论</p>

        <h3 class="mt-4 mb-3">5. 指数分布与泊松分布的关系</h3>
        <p>泊松分布描述固定时间内的事件次数，指数分布描述事件之间的等待时间。</p>
        <p class="text-muted"><strong>应用：</strong>呼叫中心、交通流量、放射性衰变</p>

        <h3 class="mt-4 mb-3">6. 对数正态分布</h3>
        <p>对数服从正态分布的随机变量：</p>
        <div class="formula-box">
          $$f(x) = \frac{1}{x\sigma\sqrt{2\pi}} e^{-\frac{(\ln x - \mu)^2}{2\sigma^2}}, \quad x > 0$$
        </div>
        <p class="text-muted"><strong>应用：</strong>股票价格、收入分布、产品寿命</p>

        <h3 class="mt-4 mb-3">7. t 分布（学生 t 分布）</h3>
        <p>用于小样本、总体标准差未知的情况：</p>
        <div class="formula-box">
          $$f(t) = \frac{\Gamma(\frac{\nu+1}{2})}{\sqrt{\nu\pi}\Gamma(\frac{\nu}{2})} \left(1 + \frac{t^2}{\nu}\right)^{-\frac{\nu+1}{2}}$$
        </div>
        <p class="text-muted"><strong>参数：</strong>自由度 ν</p>
        <p class="text-muted"><strong>特点：</strong>比正态分布更"厚尾"</p>
        <p class="text-muted"><strong>应用：</strong>小样本均值检验、置信区间</p>
      </div>

      <div class="content-card">
        <h2 class="card-title">🎯 重要定理</h2>

        <h3 class="mt-4 mb-3">1. 大数定律</h3>

        <h4 class="mb-2">弱大数定律</h4>
        <p>当样本量趋近于无穷时，样本均值依概率收敛于总体均值：</p>
        <div class="formula-box">
          $$\bar{X}_n \xrightarrow{P} \mu \quad \text{当} \quad n \to \infty$$
        </div>

        <h4 class="mb-2 mt-3">强大数定律</h4>
        <p>当样本量趋近于无穷时，样本均值几乎必然收敛于总体均值：</p>
        <div class="formula-box">
          $$\bar{X}_n \xrightarrow{a.s.} \mu \quad \text{当} \quad n \to \infty$$
        </div>

        <p class="text-muted"><strong>应用：</strong>保险定价、赌场盈利、频率稳定性的理论基础</p>

        <h3 class="mt-4 mb-3">2. 中心极限定理 (CLT)</h3>
        <p>当样本量足够大时，无论总体服从什么分布，样本均值的分布都近似服从正态分布：</p>
        <div class="formula-box">
          $$\bar{X}_n \sim N\left(\mu, \frac{\sigma^2}{n}\right) \quad \text{当} \quad n \to \infty$$
          $$\frac{\bar{X}_n - \mu}{\sigma/\sqrt{n}} \xrightarrow{d} N(0,1)$$
        </div>
        <p class="text-muted"><strong>应用：</strong>假设检验、置信区间、质量控制、抽样调查</p>

        <h3 class="mt-4 mb-3">3. 切比雪夫不等式</h3>
        <p>对于任意随机变量，给出概率的界限：</p>
        <div class="formula-box">
          $$P(|X - \mu| \geq k\sigma) \leq \frac{1}{k^2}$$
          $$P(|X - \mu| < k\sigma) \geq 1 - \frac{1}{k^2}$$
        </div>
        <p class="text-muted"><strong>应用：</strong>概率界限估计、大数定律证明、质量控制</p>
      </div>

      <div class="content-card">
        <h2 class="card-title">🎲 多维随机变量</h2>

        <h3 class="mt-4 mb-3">1. 联合分布</h3>
        <p>描述多个随机变量同时取值的概率分布：</p>
        <div class="formula-box">
          $$F_{X,Y}(x,y) = P(X \leq x, Y \leq y)$$
        </div>

        <h3 class="mt-4 mb-3">2. 边缘分布</h3>
        <p>从联合分布中得到单个变量的分布：</p>
        <div class="formula-box">
          $$F_X(x) = F_{X,Y}(x, \infty)$$
        </div>

        <h3 class="mt-4 mb-3">3. 条件分布</h3>
        <p>在已知一个变量取值的条件下，另一个变量的分布：</p>
        <div class="formula-box">
          $$P(X=x|Y=y) = \frac{P(X=x, Y=y)}{P(Y=y)}$$
        </div>

        <h3 class="mt-4 mb-3">4. 独立性</h3>
        <p>两个随机变量独立的条件：</p>
        <div class="formula-box">
          $$P(X \leq x, Y \leq y) = P(X \leq x) \times P(Y \leq y)$$
          $$f_{X,Y}(x,y) = f_X(x) \times f_Y(y)$$
        </div>
      </div>

      <div class="content-card">
        <h2 class="card-title">🔄 大数定律演示</h2>
        <p>
          大数定律表明：当独立重复试验的次数趋近于无穷时，事件发生的频率会趋近于其理论概率。
        </p>

        <div class="mb-3">
          <label class="form-label">抛硬币次数：</label>
          <input
            type="number"
            class="form-control"
            id="coinFlips"
            value="10"
            min="1"
            max="1000"
          />
        </div>

        <button class="btn btn-custom btn-primary-custom" onclick="flipCoin()">
          开始抛硬币
        </button>

        <div id="flipResults" class="mt-4" style="display: none;">
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="content-card" style="border-left: 4px solid var(--primary-color);">
                <h4 class="mb-3">🌞 正面</h4>
                <h2 style="color: var(--primary-color);" id="headsCount">0 次</h2>
                <p class="text-muted" id="headsPercent">0%</p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="content-card" style="border-left: 4px solid var(--secondary-color);">
                <h4 class="mb-3">🌙 反面</h4>
                <h2 style="color: var(--secondary-color);" id="tailsCount">0 次</h2>
                <p class="text-muted" id="tailsPercent">0%</p>
              </div>
            </div>
          </div>

          <div class="chart-container">
            <canvas id="coinChart"></canvas>
          </div>

          <div class="alert alert-info mt-3">
            <strong>观察：</strong> 随着试验次数增加，正面比例会逐渐趋近于 50%。这就是大数定律的体现！
          </div>
        </div>
      </div>

      <div class="content-card">
        <h2 class="card-title">💡 贝叶斯定理应用示例</h2>
        <p>
          <strong>医疗检测问题：</strong> 某疾病的发病率为 0.1%，检测方法的准确率为 99%（即患病者检测为阳性的概率为 99%，健康者检测为阴性的概率为 99%）。
          如果一个人的检测结果为阳性，他真正患病的概率是多少？
        </p>
        <div class="formula-box">
          $$P(\text{患病}|\text{阳性}) = \frac{0.99 \times 0.001}{0.99 \times 0.001 + 0.01 \times 0.999} \approx 9\%$$
        </div>
        <p class="text-danger">
          <strong>结论：</strong> 即使检测准确率高达 99%，阳性结果下真正患病的概率只有约 9%！
          这就是为什么需要结合先验概率来判断。
        </p>
      </div>

      <div class="content-card">
        <h2 class="card-title">🧮 概率分布计算器</h2>
        
        <ul class="nav nav-tabs" id="distTabs" role="tablist">
          <li class="nav-item">
            <button class="nav-link active" id="normal-tab" data-bs-toggle="tab" data-bs-target="#normal" type="button">正态分布</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" id="binomial-tab" data-bs-toggle="tab" data-bs-target="#binomial" type="button">二项分布</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" id="poisson-tab" data-bs-toggle="tab" data-bs-target="#poisson" type="button">泊松分布</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" id="exponential-tab" data-bs-toggle="tab" data-bs-target="#exponential" type="button">指数分布</button>
          </li>
        </ul>

        <div class="tab-content mt-4" id="distTabsContent">
          <!-- 正态分布 -->
          <div class="tab-pane fade show active" id="normal" role="tabpanel">
            <h4 class="mb-3">正态分布 N(μ, σ²)</h4>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">均值 (μ)：</label>
                <input type="number" step="any" class="form-control" id="normalMean" value="0" />
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">标准差 (σ)：</label>
                <input type="number" step="any" class="form-control" id="normalStd" value="1" min="0.0001" />
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">计算类型：</label>
                <select class="form-select" id="normalType">
                  <option value="less">P(X ≤ x)</option>
                  <option value="greater">P(X ≥ x)</option>
                  <option value="between">P(a ≤ X ≤ b)</option>
                </select>
              </div>
            </div>
            <div class="row" id="normalSingleInput">
              <div class="col-md-6 mb-3">
                <label class="form-label">x 值：</label>
                <input type="number" step="any" class="form-control" id="normalX" value="0" />
              </div>
            </div>
            <div class="row" id="normalRangeInput" style="display: none;">
              <div class="col-md-6 mb-3">
                <label class="form-label">a 值：</label>
                <input type="number" step="any" class="form-control" id="normalA" value="-1" />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">b 值：</label>
                <input type="number" step="any" class="form-control" id="normalB" value="1" />
              </div>
            </div>
            <button class="btn btn-custom btn-primary-custom" onclick="calculateNormal()">计算</button>
            <div id="normalResult" class="mt-3" style="display: none;">
              <div class="content-card" style="background: rgba(33, 150, 243, 0.1);">
                <h4 class="text-center" id="normalProbResult"></h4>
              </div>
              <div class="chart-container mt-3">
                <canvas id="normalChart"></canvas>
              </div>
            </div>
          </div>

          <!-- 二项分布 -->
          <div class="tab-pane fade" id="binomial" role="tabpanel">
            <h4 class="mb-3">二项分布 B(n, p)</h4>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">试验次数 (n)：</label>
                <input type="number" class="form-control" id="binomN" value="10" min="1" />
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">成功概率 (p)：</label>
                <input type="number" step="any" class="form-control" id="binomP" value="0.5" min="0" max="1" />
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">成功次数 (k)：</label>
                <input type="number" class="form-control" id="binomK" value="5" min="0" />
              </div>
            </div>
            <button class="btn btn-custom btn-primary-custom" onclick="calculateBinomial()">计算</button>
            <div id="binomialResult" class="mt-3" style="display: none;">
              <div class="content-card" style="background: rgba(33, 150, 243, 0.1);">
                <h4 class="text-center" id="binomProbResult"></h4>
              </div>
              <div class="row mt-3">
                <div class="col-md-6">
                  <strong>期望：</strong> <span id="binomMean"></span>
                </div>
                <div class="col-md-6">
                  <strong>方差：</strong> <span id="binomVar"></span>
                </div>
              </div>
              <div class="chart-container mt-3">
                <canvas id="binomialChart"></canvas>
              </div>
            </div>
          </div>

          <!-- 泊松分布 -->
          <div class="tab-pane fade" id="poisson" role="tabpanel">
            <h4 class="mb-3">泊松分布 P(λ)</h4>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">平均发生率 (λ)：</label>
                <input type="number" step="any" class="form-control" id="poissonLambda" value="5" min="0" />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">事件次数 (k)：</label>
                <input type="number" class="form-control" id="poissonK" value="5" min="0" />
              </div>
            </div>
            <button class="btn btn-custom btn-primary-custom" onclick="calculatePoisson()">计算</button>
            <div id="poissonResult" class="mt-3" style="display: none;">
              <div class="content-card" style="background: rgba(33, 150, 243, 0.1);">
                <h4 class="text-center" id="poissonProbResult"></h4>
              </div>
              <div class="row mt-3">
                <div class="col-md-6">
                  <strong>期望：</strong> <span id="poissonMean"></span>
                </div>
                <div class="col-md-6">
                  <strong>方差：</strong> <span id="poissonVar"></span>
                </div>
              </div>
              <div class="chart-container mt-3">
                <canvas id="poissonChart"></canvas>
              </div>
            </div>
          </div>

          <!-- 指数分布 -->
          <div class="tab-pane fade" id="exponential" role="tabpanel">
            <h4 class="mb-3">指数分布 Exp(λ)</h4>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">率参数 (λ)：</label>
                <input type="number" step="any" class="form-control" id="expLambda" value="1" min="0.0001" />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">x 值：</label>
                <input type="number" step="any" class="form-control" id="expX" value="1" min="0" />
              </div>
            </div>
            <button class="btn btn-custom btn-primary-custom" onclick="calculateExponential()">计算</button>
            <div id="exponentialResult" class="mt-3" style="display: none;">
              <div class="content-card" style="background: rgba(33, 150, 243, 0.1);">
                <h4 class="text-center" id="expProbResult"></h4>
              </div>
              <div class="row mt-3">
                <div class="col-md-4">
                  <strong>P(X ≤ x)：</strong> <span id="expLess"></span>
                </div>
                <div class="col-md-4">
                  <strong>P(X ≥ x)：</strong> <span id="expGreater"></span>
                </div>
                <div class="col-md-4">
                  <strong>期望：</strong> <span id="expMean"></span>
                </div>
              </div>
              <div class="chart-container mt-3">
                <canvas id="exponentialChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="assets/bootstrap-custom.js"></script>
  <script src="assets/katex-custom.js"></script>
  <script src="assets/chartjs-custom.js"></script>
  <script>
    let coinChartInstance = null;
    let normalChartInstance = null;
    let binomialChartInstance = null;
    let poissonChartInstance = null;
    let exponentialChartInstance = null;
    let flipResults = [];

    function flipCoin() {
      const coinFlips = parseInt(document.getElementById('coinFlips').value) || 10;
      flipResults = [];

      for (let i = 0; i < coinFlips; i++) {
        flipResults.push(Math.random() < 0.5 ? '正面' : '反面');
      }

      const heads = flipResults.filter(f => f === '正面').length;
      const tails = flipResults.filter(f => f === '反面').length;
      const headsPercent = ((heads / flipResults.length) * 100).toFixed(1);
      const tailsPercent = ((tails / flipResults.length) * 100).toFixed(1);

      document.getElementById('headsCount').textContent = `${heads} 次`;
      document.getElementById('tailsCount').textContent = `${tails} 次`;
      document.getElementById('headsPercent').textContent = `${headsPercent}%`;
      document.getElementById('tailsPercent').textContent = `${tailsPercent}%`;

      document.getElementById('flipResults').style.display = 'block';

      const ctx = document.getElementById('coinChart').getContext('2d');

      if (coinChartInstance) {
        coinChartInstance.destroy();
      }

      const cumulativeData = flipResults.map((_, i) => {
        const subFlips = flipResults.slice(0, i + 1);
        const h = subFlips.filter(f => f === '正面').length;
        return ((h / (i + 1)) * 100).toFixed(1);
      });

      coinChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: flipResults.map((_, i) => i + 1),
          datasets: [{
            label: '累计正面比例',
            data: cumulativeData,
            borderColor: 'rgba(33, 150, 243, 1)',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            tension: 0.4,
            fill: true,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: '大数定律演示：正面比例随试验次数趋近于50%',
            },
          },
          scales: {
            y: {
              min: 0,
              max: 100,
              title: {
                display: true,
                text: '正面比例 (%)'
              }
            },
            x: {
              title: {
                display: true,
                text: '试验次数'
              }
            }
          }
        }
      });
    }

    // 正态分布 CDF (使用误差函数近似)
    function normalCDF(x, mean, std) {
      return 0.5 * (1 + erf((x - mean) / (std * Math.sqrt(2))));
    }

    // 误差函数近似
    function erf(x) {
      const sign = (x >= 0) ? 1 : -1;
      x = Math.abs(x);
      const a1 =  0.254829592;
      const a2 = -0.284496736;
      const a3 =  1.421413741;
      const a4 = -1.453152027;
      const a5 =  1.061405429;
      const p  =  0.3275911;
      const t = 1.0 / (1.0 + p * x);
      const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
      return sign * y;
    }

    // 正态分布 PDF
    function normalPDF(x, mean, std) {
      return (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
    }

    // 二项分布
    function binomialPMF(n, k, p) {
      if (k < 0 || k > n) return 0;
      return factorial(n) / (factorial(k) * factorial(n - k)) * Math.pow(p, k) * Math.pow(1 - p, n - k);
    }

    // 泊松分布
    function poissonPMF(k, lambda) {
      if (k < 0) return 0;
      return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
    }

    // 阶乘
    function factorial(n) {
      if (n === 0 || n === 1) return 1;
      let result = 1;
      for (let i = 2; i <= n; i++) {
        result *= i;
      }
      return result;
    }

    // 指数分布
    function exponentialCDF(x, lambda) {
      return 1 - Math.exp(-lambda * x);
    }

    function exponentialPDF(x, lambda) {
      return lambda * Math.exp(-lambda * x);
    }

    function calculateNormal() {
      const mean = parseFloat(document.getElementById('normalMean').value);
      const std = parseFloat(document.getElementById('normalStd').value);
      const type = document.getElementById('normalType').value;
      
      let prob;
      let x1, x2;

      if (type === 'between') {
        x1 = parseFloat(document.getElementById('normalA').value);
        x2 = parseFloat(document.getElementById('normalB').value);
        prob = normalCDF(x2, mean, std) - normalCDF(x1, mean, std);
      } else {
        x1 = parseFloat(document.getElementById('normalX').value);
        if (type === 'less') {
          prob = normalCDF(x1, mean, std);
        } else {
          prob = 1 - normalCDF(x1, mean, std);
        }
      }

      let resultText = '';
      if (type === 'less') {
        resultText = `P(X ≤ ${x1}) = ${prob.toFixed(6)}`;
      } else if (type === 'greater') {
        resultText = `P(X ≥ ${x1}) = ${prob.toFixed(6)}`;
      } else {
        resultText = `P(${x1} ≤ X ≤ ${x2}) = ${prob.toFixed(6)}`;
      }

      document.getElementById('normalProbResult').textContent = resultText;
      document.getElementById('normalResult').style.display = 'block';

      // 绘制图表
      const ctx = document.getElementById('normalChart').getContext('2d');
      if (normalChartInstance) {
        normalChartInstance.destroy();
      }

      const rangeMin = mean - 4 * std;
      const rangeMax = mean + 4 * std;
      const step = (rangeMax - rangeMin) / 200;
      const labels = [];
      const data = [];
      const highlightData = [];

      for (let x = rangeMin; x <= rangeMax; x += step) {
        labels.push(x.toFixed(2));
        const pdf = normalPDF(x, mean, std);
        data.push(pdf);
        
        let highlight = false;
        if (type === 'less' && x <= x1) highlight = true;
        else if (type === 'greater' && x >= x1) highlight = true;
        else if (type === 'between' && x >= x1 && x <= x2) highlight = true;
        
        highlightData.push(highlight ? pdf : null);
      }

      normalChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: '概率密度',
            data: data,
            borderColor: 'rgba(33, 150, 243, 1)',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            fill: false,
            tension: 0.4,
            pointRadius: 0,
          }, {
            label: '选中区域',
            data: highlightData,
            backgroundColor: 'rgba(33, 150, 243, 0.4)',
            fill: true,
            tension: 0.4,
            pointRadius: 0,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: `正态分布 N(${mean}, ${std}²)`
            }
          }
        }
      });
    }

    function calculateBinomial() {
      const n = parseInt(document.getElementById('binomN').value);
      const p = parseFloat(document.getElementById('binomP').value);
      const k = parseInt(document.getElementById('binomK').value);

      const prob = binomialPMF(n, k, p);
      const mean = n * p;
      const variance = n * p * (1 - p);

      document.getElementById('binomProbResult').textContent = `P(X = ${k}) = ${prob.toFixed(6)}`;
      document.getElementById('binomMean').textContent = mean.toFixed(4);
      document.getElementById('binomVar').textContent = variance.toFixed(4);
      document.getElementById('binomialResult').style.display = 'block';

      // 绘制图表
      const ctx = document.getElementById('binomialChart').getContext('2d');
      if (binomialChartInstance) {
        binomialChartInstance.destroy();
      }

      const labels = [];
      const data = [];
      const colors = [];

      for (let i = 0; i <= n; i++) {
        labels.push(i.toString());
        const pmf = binomialPMF(n, i, p);
        data.push(pmf);
        colors.push(i === k ? 'rgba(244, 67, 54, 0.8)' : 'rgba(33, 150, 243, 0.6)');
      }

      binomialChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'P(X = k)',
            data: data,
            backgroundColor: colors,
            borderColor: colors.map(c => c.replace('0.6', '1').replace('0.8', '1')),
            borderWidth: 1,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: `二项分布 B(${n}, ${p})`
            }
          }
        }
      });
    }

    function calculatePoisson() {
      const lambda = parseFloat(document.getElementById('poissonLambda').value);
      const k = parseInt(document.getElementById('poissonK').value);

      const prob = poissonPMF(k, lambda);

      document.getElementById('poissonProbResult').textContent = `P(X = ${k}) = ${prob.toFixed(6)}`;
      document.getElementById('poissonMean').textContent = lambda.toFixed(4);
      document.getElementById('poissonVar').textContent = lambda.toFixed(4);
      document.getElementById('poissonResult').style.display = 'block';

      // 绘制图表
      const ctx = document.getElementById('poissonChart').getContext('2d');
      if (poissonChartInstance) {
        poissonChartInstance.destroy();
      }

      const maxK = Math.max(k * 2, Math.ceil(lambda + 3 * Math.sqrt(lambda)));
      const labels = [];
      const data = [];
      const colors = [];

      for (let i = 0; i <= maxK; i++) {
        labels.push(i.toString());
        const pmf = poissonPMF(i, lambda);
        data.push(pmf);
        colors.push(i === k ? 'rgba(244, 67, 54, 0.8)' : 'rgba(33, 150, 243, 0.6)');
      }

      poissonChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'P(X = k)',
            data: data,
            backgroundColor: colors,
            borderColor: colors.map(c => c.replace('0.6', '1').replace('0.8', '1')),
            borderWidth: 1,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: `泊松分布 P(${lambda})`
            }
          }
        }
      });
    }

    function calculateExponential() {
      const lambda = parseFloat(document.getElementById('expLambda').value);
      const x = parseFloat(document.getElementById('expX').value);

      const lessProb = exponentialCDF(x, lambda);
      const greaterProb = 1 - lessProb;
      const mean = 1 / lambda;

      document.getElementById('expProbResult').textContent = `P(X = ${x}) = ${exponentialPDF(x, lambda).toFixed(6)}`;
      document.getElementById('expLess').textContent = lessProb.toFixed(6);
      document.getElementById('expGreater').textContent = greaterProb.toFixed(6);
      document.getElementById('expMean').textContent = mean.toFixed(4);
      document.getElementById('exponentialResult').style.display = 'block';

      // 绘制图表
      const ctx = document.getElementById('exponentialChart').getContext('2d');
      if (exponentialChartInstance) {
        exponentialChartInstance.destroy();
      }

      const maxX = Math.max(x * 2, mean * 4);
      const step = maxX / 100;
      const labels = [];
      const data = [];
      const highlightData = [];

      for (let val = 0; val <= maxX; val += step) {
        labels.push(val.toFixed(2));
        const pdf = exponentialPDF(val, lambda);
        data.push(pdf);
        highlightData.push(val <= x ? pdf : null);
      }

      exponentialChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: '概率密度',
            data: data,
            borderColor: 'rgba(33, 150, 243, 1)',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            fill: false,
            tension: 0.4,
            pointRadius: 0,
          }, {
            label: 'P(X ≤ x)',
            data: highlightData,
            backgroundColor: 'rgba(33, 150, 243, 0.4)',
            fill: true,
            tension: 0.4,
            pointRadius: 0,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: `指数分布 Exp(${lambda})`
            }
          },
          scales: {
            x: {
              min: 0
            },
            y: {
              min: 0
            }
          }
        }
      });
    }

    // 监听正态分布类型变化
    document.getElementById('normalType').addEventListener('change', function() {
      const type = this.value;
      if (type === 'between') {
        document.getElementById('normalSingleInput').style.display = 'none';
        document.getElementById('normalRangeInput').style.display = 'flex';
      } else {
        document.getElementById('normalSingleInput').style.display = 'flex';
        document.getElementById('normalRangeInput').style.display = 'none';
      }
    });

    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false}
        ]
      });
    });
  </script>
</body>
</html>